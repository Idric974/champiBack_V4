<div class="relayContainer">
  <!-- EAU AU SOL -->
  <div class="boxCardEauAuSol">
    <div class="boxCardRelayData">
      <p class="boxCardRelayTitle">Eau au sol</p>
      <button id="btnRelayEauSol" class="boutonActivation">Activation</button>
    </div>
  </div>
  <!-- FIN EAU AU SOL -->

  <!-- VENTILATEUR HUMIDITÃƒâ€° -->
  <div class="boxCardVentilateur">
    <div class="boxCardRelayData">
      <p class="boxCardRelayTitle">Ventilateur humiditÃƒÂ©</p>
      <button id="ventilateurHumiditeOn" class="boutonActivation">
        Activation
      </button>
      <button id="ventilateurHumiditeOff" class="boutonDeactivation">
        DÃƒÂ©activation
      </button>
    </div>
  </div>
  <!-- FIN VENTILATEUR HUMIDITÃƒâ€° -->

  <div class="boxCardAction">
    <div class="boxCardRelayData">
      <p id="etatRelay" class="boxCardRelayTitle"></p>

      <div class="boxCardRelay_3Box">
        <!-- ETAT VANNE FROID A 5 SCONDES -->
        <div class="buttonBox">
          <div class="buttonBoxTitle">Action ÃƒÂ  5 secondes</div>
          <button id="vanneFroid5SesoncdesOn" class="boutonActivation">
            Ouverture
          </button>
          <button id="vanneFroid5SesoncdesOff" class="boutonDeactivation">
            Fermeture
          </button>
        </div>

        <!-- ETAT VANNE FROID A 40 SCONDES -->
        <div class="buttonBox">
          <div class="buttonBoxTitle">Action ÃƒÂ  40 secondes</div>
          <button id="vanneFroid40SesoncdesOn" class="boutonActivation">
            Ouverture
          </button>
          <button id="vanneFroid40SesoncdesOff" class="boutonDeactivation">
            Fermeture
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- FIN ETAT VANNE FROID -->
</div>

<script>
  // ** ðŸŸ¢ CLIC SUR LE BOUTON EAU AU SOL ðŸŸ¢

  document
    .getElementById("btnRelayEauSol")
    .addEventListener("click", function () {
      let element = document.getElementById("btnRelayEauSol");
      element.style.backgroundColor = "red";
      element.innerHTML = "Eau au sol activÃ©e";
      console.log("Eau au sol activÃ©e");

      fetch("http://localhost:3003/gestionRelayApiRoutes/activerRelayEauAuSol/")
        .then(function (response) {
          if (!response.ok) {
            throw new Error(
              "Network response was not ok " + response.statusText
            );
          }
          return response.json();
        })
        .then(function (data) {
          console.log(data);
          window.location.reload();
        })
        .catch(function (error) {
          console.log("Fetch error: ", error);
        });
    });

  // ** ðŸŸ¢ GESTION VENTILATEUR HUMIDITÃ‰ ðŸŸ¢

  let ventilateurHumidite;

  //? Ventilateur ON.
  document
    .getElementById("ventilateurHumiditeOn")
    .addEventListener("click", function () {
      fetch("http://localhost:3003/gestionRelayApiRoutes/relayVentilo/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          relayVentilo: 1,
        }),
      })
        .then(function (response) {
          if (!response.ok) {
            throw new Error(
              "Network response was not ok " + response.statusText
            );
          }
          return response.json();
        })
        .then(function (data) {
          console.log(data);
        })
        .catch(function (error) {
          console.log("Fetch error: ", error);
        });
    });

  //? -------------------------------------------------

  //? Ventilateur OFF.
  document
    .getElementById("ventilateurHumiditeOff")
    .addEventListener("click", function () {
      fetch("http://localhost:3003/gestionRelayApiRoutes/relayVentilo/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          relayVentilo: 0,
        }),
      })
        .then(function (response) {
          if (!response.ok) {
            throw new Error(
              "Network response was not ok " + response.statusText
            );
          }
          return response.json();
        })
        .then(function (data) {
          console.log(data);
        })
        .catch(function (error) {
          console.log("Fetch error: ", error);
        });
    });

  //? -------------------------------------------------

  // ** ðŸŸ¢ AFFICHAGE DE L'Ã‰TAT DE LA VANNE FROID ðŸŸ¢

  let etatRelay;
  let etatRelayBrute;
  let etatRelayLocalStorage;

  let afficheEtatRelay = () => {
    fetch("http://localhost:3003/gestionAirRoutesFront/getTemperatureAir/")
      .then(function (response) {
        if (!response.ok) {
          throw new Error("Network response was not ok " + response.statusText);
        }
        return response.json();
      })
      .then(function (data) {
        etatRelayBrute = data.temperatureAir.etatRelay;
        // console.log("etatRelayBrute ==> ", etatRelayBrute);
        etatRelayLocalStorage = etatRelayBrute;
      })
      .then(() => {
        etatRelay = JSON.stringify(etatRelayLocalStorage);
        localStorage.setItem("Etat relay : ", etatRelay);
        document.getElementById("etatRelay").innerHTML =
          "Etat Vanne froid Ã  : " + etatRelay + "%";
      })
      .catch(function (error) {
        console.log("Fetch error: ", error);
      });
  };

  afficheEtatRelay();

  // ** ðŸŸ¢ GESTION DE VANNE FROID Ã€ 5 SECONDES ON ðŸŸ¢

  document
    .getElementById("vanneFroid5SesoncdesOn")
    .addEventListener("click", function () {
      let valeurEtatVanne;

      fetch("http://localhost:3003/gestionAirRoutesFront/getTemperatureAir/")
        .then(function (response) {
          if (!response.ok) {
            throw new Error(
              "Network response was not ok " + response.statusText
            );
          }
          return response.json();
        })
        .then(function (data) {
          valeurEtatVanne = data.temperatureAir.actionRelay;
          console.log("Valeur Etat Vanne ===> ", valeurEtatVanne);
        })
        .then(() => {
          if (valeurEtatVanne == 1) {
            afficheEtatRelay();
            alert("ATTENTION!! ACTION VANNE EN COURS");
            return;
          } else if (etatRelayBrute >= 100) {
            alert("VANNE DEJA OUVERTE Ã€ 100%");
            return;
          } else {
            let etatVanne = "ON";

            fetch(
              "http://localhost:3003/gestionRelayApiRoutes/relayVanneFroid5Secondes/",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  etatRelay: etatVanne,
                }),
              }
            )
              .then(function (response) {
                if (!response.ok) {
                  throw new Error(
                    "Network response was not ok " + response.statusText
                  );
                }
                return response.json();
              })
              .then(function (data) {
                console.log(data);
              })
              .catch(function (error) {
                console.log("Fetch error: ", error);
              });
          }
        })
        .catch(function (error) {
          console.log("Fetch error: ", error);
        });

      setTimeout(() => {
        afficheEtatRelay();
      }, 6000);
    });

  //! -------------------------------------------------

  // ** ðŸŸ¢ GESTION DE VANNE FROID Ã€ 5 SECONDES OFF ðŸŸ¢

  document
    .getElementById("vanneFroid5SesoncdesOff")
    .addEventListener("click", function () {
      let valeurEtatVanne;

      fetch("http://localhost:3003/gestionAirRoutesFront/getTemperatureAir/")
        .then(function (response) {
          if (!response.ok) {
            throw new Error(
              "Network response was not ok " + response.statusText
            );
          }
          return response.json();
        })
        .then(function (data) {
          valeurEtatVanne = data.temperatureAir.actionRelay;
          console.log("Valeur Etat Vanne ===> ", valeurEtatVanne);
        })
        .then(() => {
          if (valeurEtatVanne == 1) {
            afficheEtatRelay();
            alert("ATTENTION!! ACTION VANNE EN COURS");
            return;
          } else if (etatRelayBrute <= 0) {
            alert("VANNE DEJA FERMÃ‰E");
            return;
          } else {
            let etatVanne = "OFF";

            fetch(
              "http://localhost:3003/gestionRelayApiRoutes/relayVanneFroid5Secondes/",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  etatRelay: etatVanne,
                }),
              }
            )
              .then(function (response) {
                if (!response.ok) {
                  throw new Error(
                    "Network response was not ok " + response.statusText
                  );
                }
                return response.json();
              })
              .then(function (data) {
                console.log(data);
              })
              .catch(function (error) {
                console.log("Fetch error: ", error);
              });
          }
        })
        .catch(function (error) {
          console.log("Fetch error: ", error);
        });

      setTimeout(() => {
        afficheEtatRelay();
      }, 6000);
    });

  //! -------------------------------------------------

  // ** ðŸŸ¢ GESTION DE VANNE FROID Ã€ 40 SECONDES ON ðŸŸ¢

  document
    .getElementById("vanneFroid40SesoncdesOn")
    .addEventListener("click", function () {
      let valeurEtatVanne;

      fetch("http://localhost:3003/gestionAirRoutesFront/getTemperatureAir/")
        .then(function (response) {
          if (!response.ok) {
            throw new Error(
              "Network response was not ok " + response.statusText
            );
          }
          return response.json();
        })
        .then(function (data) {
          valeurEtatVanne = data.temperatureAir.actionRelay;
          console.log("Valeur Etat Vanne ===> ", valeurEtatVanne);
        })
        .then(() => {
          if (valeurEtatVanne == 1) {
            afficheEtatRelay();
            alert("ATTENTION!! ACTION VANNE EN COURS");
            return;
          } else if (etatRelayBrute >= 100) {
            alert("VANNE DEJA OUVERTE Ã€ 100%");
            return;
          } else {
            let etatVanne = "ON";

            fetch(
              "http://localhost:3003/gestionRelayApiRoutes/relayVanneFroid40Secondes/",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  etatRelay: etatVanne,
                }),
              }
            )
              .then(function (response) {
                if (!response.ok) {
                  throw new Error(
                    "Network response was not ok " + response.statusText
                  );
                }
                return response.json();
              })
              .then(function (data) {
                console.log(data);
              })
              .catch(function (error) {
                console.log("Fetch error: ", error);
              });
          }
        })
        .catch(function (error) {
          console.log("Fetch error: ", error);
        });

      setTimeout(() => {
        afficheEtatRelay();
      }, 6000);
    });

  //! -------------------------------------------------

  // ** ðŸŸ¢ GESTION DE VANNE FROID Ã€ 40 SECONDES OFF ðŸŸ¢

  document
    .getElementById("vanneFroid40SesoncdesOff")
    .addEventListener("click", function () {
      let valeurEtatVanne;

      fetch("http://localhost:3003/gestionAirRoutesFront/getTemperatureAir/")
        .then(function (response) {
          if (!response.ok) {
            throw new Error(
              "Network response was not ok " + response.statusText
            );
          }
          return response.json();
        })
        .then(function (data) {
          valeurEtatVanne = data.temperatureAir.actionRelay;
          console.log("Valeur Etat Vanne ===> ", valeurEtatVanne);
        })
        .then(() => {
          if (valeurEtatVanne == 1) {
            afficheEtatRelay();
            alert("ATTENTION!! ACTION VANNE EN COURS");
            return;
          } else if (etatRelayBrute <= 0) {
            alert("VANNE DEJA FERMÃ‰E");
            return;
          } else {
            let etatVanne = "OFF";

            fetch(
              "http://localhost:3003/gestionRelayApiRoutes/relayVanneFroid40Secondes/",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  etatRelay: etatVanne,
                }),
              }
            )
              .then(function (response) {
                if (!response.ok) {
                  throw new Error(
                    "Network response was not ok " + response.statusText
                  );
                }
                return response.json();
              })
              .then(function (data) {
                console.log(data);
              })
              .catch(function (error) {
                console.log("Fetch error: ", error);
              });
          }
        })
        .catch(function (error) {
          console.log("Fetch error: ", error);
        });

      setTimeout(() => {
        afficheEtatRelay();
      }, 6000);
    });

  //! -------------------------------------------------
</script>
