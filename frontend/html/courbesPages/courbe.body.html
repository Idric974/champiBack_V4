<div class="containerCourbe">
  <!-- âž–âž– â­ SHOW DATA â­ âž–âž– -->

  <div class="demarrerCycle">
    <div class="boxButtonDemCycle">
      <button id="btnAir" class="demarrerCycleButton">
        DÃ©marrer un cycle
      </button>

      <div id="dateDemarrageCycle" class="demarrerCycleDate">Date</div>
      <div id="jourDuCycle" class="demarrerCycleJour">Jour</div>
    </div>

    <small id="infoSmallId" class="infoSmall infoSmallDisplay"
      >La date de dÃ©but de cycle Ã  Ã©tÃ© crÃ©Ã© et enregistrÃ©e dans la base
      de donnÃ©es.</small
    >
  </div>

  <div class="container">
    <!-- Boutons des tabs. -->
    <div class="container-onglets">
      <p class="onglets active">Gestion courbes air</p>
      <p class="onglets">Gestion courbes humiditÃ©</p>
      <p class="onglets">Gestion courbes Co2</p>
    </div>
    <!-- Fin Boutons des tabs. -->

    <!-- Courbes gestionAir -->
    <div class="contenu active-contenu">
      <div class="graphData">
        <canvas id="myChartAir"></canvas>
      </div>

      <div class="graphVanne">
        <canvas id="myChartAirVanne"></canvas>
      </div>
    </div>
    <!-- FIN Courbes gestionAir -->

    <!-- Courbes gestionHum -->
    <div class="contenu">
      <canvas id="myChartHum"></canvas>
    </div>
    <!-- FIN Courbes gestionHum -->

    <!-- Courbes gestionHum -->
    <div class="contenu">
      <canvas id="myChartCo2"></canvas>
    </div>
    <!-- Courbes gestionCo2 -->
  </div>
</div>

<script>
  // ** 🟢 LOGIQUE POUR LA GESTION DES ONGLETS. 🟢

  const onglets = Array.from(document.querySelectorAll(".onglets"));
  const contenu = Array.from(document.querySelectorAll(".contenu"));

  onglets.forEach((onglet) => {
    onglet.addEventListener("click", tabsAnimation);
  });

  let index = 0;

  function tabsAnimation(e) {
    const el = e.target;

    onglets[index].classList.remove("active");
    contenu[index].classList.remove("active-contenu");

    index = onglets.indexOf(el);

    onglets[index].classList.add("active");
    contenu[index].classList.add("active-contenu");
  }

  // ** 🟢 AFFICHAGE DU JOUR DU CYCLE 🟢

  let getJourDuCycle = () => {
    fetch("http://localhost:3003/gestionAirRoutesFront/getTemperatureAir/")
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok " + response.statusText);
        }
        return response.json();
      })
      .then((data) => {
        console.log("Jour du cycle : ", data.temperatureAir.jourDuCycle);

        let jourDuCycle = data.temperatureAir.jourDuCycle;

        localStorage.setItem("Jour du cycle : ", jourDuCycle);

        let jourDuCycleLocalStorage = localStorage.getItem("Jour du cycle : ");

        document.getElementById("jourDuCycle").innerHTML =
          "Jour " + jourDuCycleLocalStorage;
      })
      .catch((error) => {
        console.log("Fetch error: ", error);
        console.log(JSON.stringify(error));
      });
  };

  getJourDuCycle();

  setInterval(() => {
    getJourDuCycle();
  }, 3600000);

  // ** 🟢 AFFICHAGE DATE DÉMARRAGE CYCLE 🟢

  let dateDemarrageDuCycle;
  let dateDemarrageDuCycleStorage;

  let getDateDemarrageDuCycle = () => {
    fetch(
      "http://localhost:3003/gestionCourbesApiRoutes/getDateDemarrageCycle/"
    )
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok " + response.statusText);
        }
        return response.json();
      })
      .then((data) => {
        dateDemarrageDuCycle = new Date(
          data.dateDemarrageCycle.dateDemarrageCycle
        )
          .toLocaleString()
          .split(",")[0];

        localStorage.setItem("Date démarrage cycle : ", dateDemarrageDuCycle);

        dateDemarrageDuCycleStorage = localStorage.getItem(
          "Date démarrage cycle : "
        );

        document.getElementById("dateDemarrageCycle").innerHTML =
          "Date démarrage cycle : " + dateDemarrageDuCycleStorage;
      })
      .catch((error) => {
        console.log("Fetch error: ", error);
        console.log(JSON.stringify(error));
      });
  };

  getDateDemarrageDuCycle();

  // ** 🟢 Bouton création de la date de début du cycle AIR 🟢

  var btnAir = document.getElementById("btnAir");
  btnAir.addEventListener(
    "click",
    function () {
      let text = "Etes-vous sûre de vouloir démarrer un cycle ?";
      if (confirm(text) == true) {
        let dateDemarrageCycle = new Date();
        console.log("Date de demarrage du cycle : ", dateDemarrageCycle);

        fetch(
          "http://localhost:3003/gestionCourbesApiRoutes/dateDemarrageCycle/",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              dateDemarrageCycle: dateDemarrageCycle,
            }),
          }
        )
          .then(function (response) {
            if (!response.ok) {
              throw new Error(
                "Network response was not ok " + response.statusText
              );
            }
            return response.json();
          })
          .then(function (data) {
            console.log(data);
          })
          .catch(function (error) {
            console.log("Fetch error: ", error);
          });

        const infoSmall = document.getElementById("infoSmallButton");
        infoSmall.classList.remove("infoSmallDisplay");

        getJourDuCycle();

        setTimeout(() => {
          infoSmall.classList.add("infoSmallDisplay");
        }, 5000);

        setTimeout(() => {
          location.reload();
        }, 5500);
      } else {
        console.log("You canceled!");
      }
    },
    false
  );
</script>
